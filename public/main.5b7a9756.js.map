{"version":3,"sources":["js/idb.min.js","js/dbhelper.js","node_modules/vanilla-lazyload/dist/lazyload.es2015.js","js/main.js"],"names":["promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","prototype","get","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","promisifyCursorRequestCall","value","Cursor","Index","index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","onabort","UpgradeDB","db","oldVersion","transaction","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","funcName","replace","arr","Array","slice","call","callback","length","nativeObject","getAll","query","count","instance","items","iterateCursor","push","undefined","continue","exp","open","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","module","exports","default","self","idb","require","DBHelper","navigator","onLine","fetch","DATABASE_URL","response","json","restaurants","upgradeDB","keyPath","tx","keyValStore","restaurant","put","catch","console","log","id","fetchRestaurants","find","r","cuisine","results","filter","cuisine_type","neighborhood","neighborhoods","map","v","i","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","images","photograph","marker","L","latlng","lat","lng","title","alt","url","urlForRestaurant","addTo","review","offlineObj","data","object_type","reviewObject","rating","comments","restaurant_id","options","body","JSON","stringify","headers","Headers","contentType","document","getElementById","remove","warn","sendDataOnline","localStorage","setItem","window","addEventListener","parse","getItem","postReview","removeItem","reviews","isArray","getObject","sReviews","restaurantId","isFavorite","favorite","restaurantObject","is_favorite","port","LazyLoad","getDefaultSettings","elements_selector","container","threshold","throttle","data_src","data_srcset","data_sizes","data_bg","class_loading","class_loaded","class_error","class_initial","skip_invisible","callback_load","callback_error","callback_set","callback_processed","callback_enter","to_webp","getTopOffset","element","getBoundingClientRect","top","pageYOffset","ownerDocument","documentElement","clientTop","isBelowViewport","fold","innerHeight","offsetHeight","getLeftOffset","left","pageXOffset","clientLeft","isAtRightOfViewport","documentWidth","innerWidth","isAboveViewport","isAtLeftOfViewport","offsetWidth","isInsideViewport","createInstance","classObj","eventString","CustomEvent","detail","err","createEvent","initCustomEvent","dispatchEvent","autoInitialize","optionsItem","replaceExtToWebp","condition","detectWebp","webpString","canvas","createElement","getContext","toDataURL","runningOnBrowser","isBot","test","userAgent","supportsClassList","supportsWebp","addClass","className","classList","add","removeClass","RegExp","dataPrefix","processedDataName","processedDataValue","getData","attribute","getAttribute","setData","attrName","setAttribute","removeAttribute","setWasProcessedData","getWasProcessedData","setSourcesInChildren","parentTag","dataAttrName","toWebpFlag","childTag","children","tagName","attrValue","setAttributeIfValue","setSourcesImg","settings","srcsetDataName","parent","parentNode","sizesDataValue","srcsetDataValue","srcDataValue","setSourcesIframe","setSourcesVideo","srcDataName","load","setSourcesBgImage","bgDataValue","setValue","style","backgroundImage","setSourcesFunctions","IMG","IFRAME","VIDEO","setSources","setSourcesFunction","callbackIfSet","argument","genericLoadEventName","mediaLoadEventName","errorEventName","eventName","handler","removeEventListener","addAllEventListeners","loadHandler","errorHandler","removeAllEventListeners","eventHandler","success","target","addOneShotEventListeners","managedTags","revealElement","force","removeFromArray","elements","indexes","splice","pop","instanceSettings","_settings","assign","_queryOriginNode","_previousLoopTime","_loopTimeout","_boundHandleScroll","handleScroll","bind","_isFirstLoop","update","_loopThroughElements","forceDownload","_elements","elementsLength","processedIndexes","isFirstLoop","offsetParent","_stopScrollHandler","_purgeElements","_startScrollHandler","_isHandlingScroll","now","Date","remainingTime","clearTimeout","setTimeout","loadAll","querySelectorAll","destroy","lazyLoadOptions","newMap","markers","initMap","fetchNeighborhoods","fetchCuisines","fillNeighborhoodsHTML","select","option","innerHTML","append","fillCuisinesHTML","Map","center","zoom","scrollWheelZoom","tileLayer","mapboxToken","maxZoom","attribution","updateRestaurants","cSelect","nSelect","cIndex","selectedIndex","nIndex","fetchRestaurantByCuisineAndNeighborhood","resetRestaurants","fillRestaurantsHTML","ul","createRestaurantHTML","addMarkersToMap","li","image","imageUrlForRestaurant","float","onclick","updateFavorite","address","more","href","mapMarkerForRestaurant","on","onClick","location"],"mappings":"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","file":"main.5b7a9756.js","sourceRoot":"..","sourcesContent":["'use strict';(function(){function toArray(arr){return Array.prototype.slice.call(arr);}\n  function promisifyRequest(request){return new Promise(function(resolve,reject){request.onsuccess=function(){resolve(request.result);};request.onerror=function(){reject(request.error);};});}\n  function promisifyRequestCall(obj,method,args){var request;var p=new Promise(function(resolve,reject){request=obj[method].apply(obj,args);promisifyRequest(request).then(resolve,reject);});p.request=request;return p;}\n  function promisifyCursorRequestCall(obj,method,args){var p=promisifyRequestCall(obj,method,args);return p.then(function(value){if(!value)return;return new Cursor(value,p.request);});}\n  function proxyProperties(ProxyClass,targetProp,properties){properties.forEach(function(prop){Object.defineProperty(ProxyClass.prototype,prop,{get:function(){return this[targetProp][prop];},set:function(val){this[targetProp][prop]=val;}});});}\n  function proxyRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyRequestCall(this[targetProp],prop,arguments);};});}\n  function proxyMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return this[targetProp][prop].apply(this[targetProp],arguments);};});}\n  function proxyCursorRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyCursorRequestCall(this[targetProp],prop,arguments);};});}\n  function Index(index){this._index=index;}\n  proxyProperties(Index,'_index',['name','keyPath','multiEntry','unique']);proxyRequestMethods(Index,'_index',IDBIndex,['get','getKey','getAll','getAllKeys','count']);proxyCursorRequestMethods(Index,'_index',IDBIndex,['openCursor','openKeyCursor']);function Cursor(cursor,request){this._cursor=cursor;this._request=request;}\n  proxyProperties(Cursor,'_cursor',['direction','key','primaryKey','value']);proxyRequestMethods(Cursor,'_cursor',IDBCursor,['update','delete']);['advance','continue','continuePrimaryKey'].forEach(function(methodName){if(!(methodName in IDBCursor.prototype))return;Cursor.prototype[methodName]=function(){var cursor=this;var args=arguments;return Promise.resolve().then(function(){cursor._cursor[methodName].apply(cursor._cursor,args);return promisifyRequest(cursor._request).then(function(value){if(!value)return;return new Cursor(value,cursor._request);});});};});function ObjectStore(store){this._store=store;}\n  ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments));};ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments));};proxyProperties(ObjectStore,'_store',['name','keyPath','indexNames','autoIncrement']);proxyRequestMethods(ObjectStore,'_store',IDBObjectStore,['put','add','delete','clear','get','getAll','getKey','getAllKeys','count']);proxyCursorRequestMethods(ObjectStore,'_store',IDBObjectStore,['openCursor','openKeyCursor']);proxyMethods(ObjectStore,'_store',IDBObjectStore,['deleteIndex']);function Transaction(idbTransaction){this._tx=idbTransaction;this.complete=new Promise(function(resolve,reject){idbTransaction.oncomplete=function(){resolve();};idbTransaction.onerror=function(){reject(idbTransaction.error);};idbTransaction.onabort=function(){reject(idbTransaction.error);};});}\n  Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments));};proxyProperties(Transaction,'_tx',['objectStoreNames','mode']);proxyMethods(Transaction,'_tx',IDBTransaction,['abort']);function UpgradeDB(db,oldVersion,transaction){this._db=db;this.oldVersion=oldVersion;this.transaction=new Transaction(transaction);}\n  UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments));};proxyProperties(UpgradeDB,'_db',['name','version','objectStoreNames']);proxyMethods(UpgradeDB,'_db',IDBDatabase,['deleteObjectStore','close']);function DB(db){this._db=db;}\n  DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments));};proxyProperties(DB,'_db',['name','version','objectStoreNames']);proxyMethods(DB,'_db',IDBDatabase,['close']);['openCursor','openKeyCursor'].forEach(function(funcName){[ObjectStore,Index].forEach(function(Constructor){if(!(funcName in Constructor.prototype))return;Constructor.prototype[funcName.replace('open','iterate')]=function(){var args=toArray(arguments);var callback=args[args.length-1];var nativeObject=this._store||this._index;var request=nativeObject[funcName].apply(nativeObject,args.slice(0,-1));request.onsuccess=function(){callback(request.result);};};});});[Index,ObjectStore].forEach(function(Constructor){if(Constructor.prototype.getAll)return;Constructor.prototype.getAll=function(query,count){var instance=this;var items=[];return new Promise(function(resolve){instance.iterateCursor(query,function(cursor){if(!cursor){resolve(items);return;}\n    items.push(cursor.value);if(count!==undefined&&items.length==count){resolve(items);return;}\n    cursor.continue();});});};});var exp={open:function(name,version,upgradeCallback){var p=promisifyRequestCall(indexedDB,'open',[name,version]);var request=p.request;if(request){request.onupgradeneeded=function(event){if(upgradeCallback){upgradeCallback(new UpgradeDB(request.result,event.oldVersion,request.transaction));}};}\n      return p.then(function(db){return new DB(db);});},delete:function(name){return promisifyRequestCall(indexedDB,'deleteDatabase',[name]);}};if(typeof module!=='undefined'){module.exports=exp;module.exports.default=module.exports;}\n  else{self.idb=exp;}}());'use strict';(function(){function toArray(arr){return Array.prototype.slice.call(arr);}\n  function promisifyRequest(request){return new Promise(function(resolve,reject){request.onsuccess=function(){resolve(request.result);};request.onerror=function(){reject(request.error);};});}\n  function promisifyRequestCall(obj,method,args){var request;var p=new Promise(function(resolve,reject){request=obj[method].apply(obj,args);promisifyRequest(request).then(resolve,reject);});p.request=request;return p;}\n  function promisifyCursorRequestCall(obj,method,args){var p=promisifyRequestCall(obj,method,args);return p.then(function(value){if(!value)return;return new Cursor(value,p.request);});}\n  function proxyProperties(ProxyClass,targetProp,properties){properties.forEach(function(prop){Object.defineProperty(ProxyClass.prototype,prop,{get:function(){return this[targetProp][prop];},set:function(val){this[targetProp][prop]=val;}});});}\n  function proxyRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyRequestCall(this[targetProp],prop,arguments);};});}\n  function proxyMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return this[targetProp][prop].apply(this[targetProp],arguments);};});}\n  function proxyCursorRequestMethods(ProxyClass,targetProp,Constructor,properties){properties.forEach(function(prop){if(!(prop in Constructor.prototype))return;ProxyClass.prototype[prop]=function(){return promisifyCursorRequestCall(this[targetProp],prop,arguments);};});}\n  function Index(index){this._index=index;}\n  proxyProperties(Index,'_index',['name','keyPath','multiEntry','unique']);proxyRequestMethods(Index,'_index',IDBIndex,['get','getKey','getAll','getAllKeys','count']);proxyCursorRequestMethods(Index,'_index',IDBIndex,['openCursor','openKeyCursor']);function Cursor(cursor,request){this._cursor=cursor;this._request=request;}\n  proxyProperties(Cursor,'_cursor',['direction','key','primaryKey','value']);proxyRequestMethods(Cursor,'_cursor',IDBCursor,['update','delete']);['advance','continue','continuePrimaryKey'].forEach(function(methodName){if(!(methodName in IDBCursor.prototype))return;Cursor.prototype[methodName]=function(){var cursor=this;var args=arguments;return Promise.resolve().then(function(){cursor._cursor[methodName].apply(cursor._cursor,args);return promisifyRequest(cursor._request).then(function(value){if(!value)return;return new Cursor(value,cursor._request);});});};});function ObjectStore(store){this._store=store;}\n  ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments));};ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments));};proxyProperties(ObjectStore,'_store',['name','keyPath','indexNames','autoIncrement']);proxyRequestMethods(ObjectStore,'_store',IDBObjectStore,['put','add','delete','clear','get','getAll','getKey','getAllKeys','count']);proxyCursorRequestMethods(ObjectStore,'_store',IDBObjectStore,['openCursor','openKeyCursor']);proxyMethods(ObjectStore,'_store',IDBObjectStore,['deleteIndex']);function Transaction(idbTransaction){this._tx=idbTransaction;this.complete=new Promise(function(resolve,reject){idbTransaction.oncomplete=function(){resolve();};idbTransaction.onerror=function(){reject(idbTransaction.error);};idbTransaction.onabort=function(){reject(idbTransaction.error);};});}\n  Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments));};proxyProperties(Transaction,'_tx',['objectStoreNames','mode']);proxyMethods(Transaction,'_tx',IDBTransaction,['abort']);function UpgradeDB(db,oldVersion,transaction){this._db=db;this.oldVersion=oldVersion;this.transaction=new Transaction(transaction);}\n  UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments));};proxyProperties(UpgradeDB,'_db',['name','version','objectStoreNames']);proxyMethods(UpgradeDB,'_db',IDBDatabase,['deleteObjectStore','close']);function DB(db){this._db=db;}\n  DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments));};proxyProperties(DB,'_db',['name','version','objectStoreNames']);proxyMethods(DB,'_db',IDBDatabase,['close']);['openCursor','openKeyCursor'].forEach(function(funcName){[ObjectStore,Index].forEach(function(Constructor){if(!(funcName in Constructor.prototype))return;Constructor.prototype[funcName.replace('open','iterate')]=function(){var args=toArray(arguments);var callback=args[args.length-1];var nativeObject=this._store||this._index;var request=nativeObject[funcName].apply(nativeObject,args.slice(0,-1));request.onsuccess=function(){callback(request.result);};};});});[Index,ObjectStore].forEach(function(Constructor){if(Constructor.prototype.getAll)return;Constructor.prototype.getAll=function(query,count){var instance=this;var items=[];return new Promise(function(resolve){instance.iterateCursor(query,function(cursor){if(!cursor){resolve(items);return;}\n    items.push(cursor.value);if(count!==undefined&&items.length==count){resolve(items);return;}\n    cursor.continue();});});};});var exp={open:function(name,version,upgradeCallback){var p=promisifyRequestCall(indexedDB,'open',[name,version]);var request=p.request;if(request){request.onupgradeneeded=function(event){if(upgradeCallback){upgradeCallback(new UpgradeDB(request.result,event.oldVersion,request.transaction));}};}\n      return p.then(function(db){return new DB(db);});},delete:function(name){return promisifyRequestCall(indexedDB,'deleteDatabase',[name]);}};if(typeof module!=='undefined'){module.exports=exp;module.exports.default=module.exports;}\n  else{self.idb=exp;}}());\n","const idb = require(\"./idb.min.js\");\r\nimport images from \"../img/*.jpg\";\r\n\r\n/**\r\n * Common database helper functions.\r\n */\r\nexport default class DBHelper {\r\n  /**\r\n   * Database URL.\r\n   * Change this to restaurants.json file location on your server.\r\n   */\r\n  static get DATABASE_URL() {\r\n    const port = 1337; // Change this to your server port\r\n    return `http://localhost:${port}/restaurants`;\r\n  }\r\n\r\n  /**\r\n   * Fetch all restaurants.\r\n   */\r\n  static fetchRestaurants(callback) {\r\n    if (navigator.onLine) {\r\n      fetch(DBHelper.DATABASE_URL)\r\n        .then(response => response.json())\r\n        .then(restaurants => {\r\n          const dbPromise = idb.open(\"restaurantsDB\", 1, upgradeDB => {\r\n            switch (upgradeDB.oldVersion) {\r\n              case 0:\r\n                upgradeDB.createObjectStore(\"restaurants\", {\r\n                  keyPath: \"id\"\r\n                });\r\n              case 1:\r\n                const reviewsTable = upgradeDB.createObjectStore(\"reviews\", {\r\n                  keyPath: \"id\"\r\n                });\r\n                reviewsTable.createIndex(\"restaurant\", \"restaurant_id\");\r\n            }\r\n          });\r\n\r\n          dbPromise.then(db => {\r\n            const tx = db.transaction(\"restaurants\", \"readwrite\");\r\n            let keyValStore = tx.objectStore(\"restaurants\");\r\n            restaurants.forEach(function(restaurant) {\r\n              keyValStore.put(restaurant);\r\n            });\r\n            return keyValStore.getAll();\r\n          });\r\n          callback(null, restaurants);\r\n        })\r\n        .catch(function(error) {\r\n          console.log(\"An error has occurred.\", error);\r\n          callback(error, null);\r\n        });\r\n    } else {\r\n      const dbPromise = idb.open(\"restaurantsDB\");\r\n\r\n      dbPromise\r\n        .then(function(db) {\r\n          var tx = db.transaction(\"restaurants\", \"readonly\");\r\n          var store = tx.objectStore(\"restaurants\");\r\n          return store.getAll();\r\n        })\r\n        .then(function(response) {\r\n          return response;\r\n        })\r\n        .then(function(restaurants) {\r\n          callback(null, restaurants);\r\n        })\r\n        .catch(function(error) {\r\n          console.log(\"An error has occurred.\", error);\r\n          callback(error, null);\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch a restaurant by its ID.\r\n   */\r\n  static fetchRestaurantById(id, callback) {\r\n    // fetch all restaurants with proper error handling.\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const restaurant = restaurants.find(r => r.id == id);\r\n        if (restaurant) {\r\n          // Got the restaurant\r\n          callback(null, restaurant);\r\n        } else {\r\n          // Restaurant does not exist in the database\r\n          callback(\"Restaurant does not exist\", null);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine type with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisine(cuisine, callback) {\r\n    // Fetch all restaurants  with proper error handling\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given cuisine type\r\n        const results = restaurants.filter(r => r.cuisine_type == cuisine);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given neighborhood\r\n        const results = restaurants.filter(r => r.neighborhood == neighborhood);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisineAndNeighborhood(\r\n    cuisine,\r\n    neighborhood,\r\n    callback\r\n  ) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let results = restaurants;\r\n        if (cuisine != \"all\") {\r\n          // filter by cuisine\r\n          results = results.filter(r => r.cuisine_type == cuisine);\r\n        }\r\n        if (neighborhood != \"all\") {\r\n          // filter by neighborhood\r\n          results = results.filter(r => r.neighborhood == neighborhood);\r\n        }\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all neighborhoods with proper error handling.\r\n   */\r\n  static fetchNeighborhoods(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all neighborhoods from all restaurants\r\n        const neighborhoods = restaurants.map(\r\n          (v, i) => restaurants[i].neighborhood\r\n        );\r\n        // Remove duplicates from neighborhoods\r\n        const uniqueNeighborhoods = neighborhoods.filter(\r\n          (v, i) => neighborhoods.indexOf(v) == i\r\n        );\r\n        callback(null, uniqueNeighborhoods);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all cuisines with proper error handling.\r\n   */\r\n  static fetchCuisines(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all cuisines from all restaurants\r\n        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);\r\n        // Remove duplicates from cuisines\r\n        const uniqueCuisines = cuisines.filter(\r\n          (v, i) => cuisines.indexOf(v) == i\r\n        );\r\n        callback(null, uniqueCuisines);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Restaurant page URL.\r\n   */\r\n  static urlForRestaurant(restaurant) {\r\n    return `./restaurant.html?id=${restaurant.id}`;\r\n  }\r\n\r\n  /**\r\n   * Restaurant image URL.\r\n   */\r\n  static imageUrlForRestaurant(restaurant) {\r\n    // return \"images[restaurant.photograph]\";\r\n    return images[restaurant.photograph];\r\n  }\r\n\r\n  /**\r\n   * Map marker for a restaurant.\r\n   */\r\n  static mapMarkerForRestaurant(restaurant, map) {\r\n    // https://leafletjs.com/reference-1.3.0.html#marker\r\n    const marker = new L.marker(\r\n      [restaurant.latlng.lat, restaurant.latlng.lng],\r\n      {\r\n        title: restaurant.name,\r\n        alt: restaurant.name,\r\n        url: DBHelper.urlForRestaurant(restaurant)\r\n      }\r\n    );\r\n    marker.addTo(map);\r\n    return marker;\r\n  }\r\n  /* static mapMarkerForRestaurant(restaurant, map) {\r\n    const marker = new google.maps.Marker({\r\n      position: restaurant.latlng,\r\n      title: restaurant.name,\r\n      url: DBHelper.urlForRestaurant(restaurant),\r\n      map: map,\r\n      animation: google.maps.Animation.DROP}\r\n    );\r\n    return marker;\r\n  } */\r\n\r\n  /**\r\n   * Store review\r\n   * @param review\r\n   */\r\n  static postReview(review) {\r\n    let offlineObj = {\r\n      name: \"postReview\",\r\n      data: review,\r\n      object_type: \"review\"\r\n    };\r\n\r\n    if (!navigator.onLine && offlineObj.name === \"postReview\") {\r\n      DBHelper.sendDataOnline(offlineObj);\r\n      return;\r\n    }\r\n\r\n    let reviewObject = {\r\n      name: review.name,\r\n      rating: review.rating,\r\n      comments: review.comments,\r\n      restaurant_id: review.restaurant_id\r\n    };\r\n    const options = {\r\n      method: \"POST\",\r\n      body: JSON.stringify(reviewObject),\r\n      headers: new Headers({\r\n        \"Content-Type\": \"application/json\"\r\n      })\r\n    };\r\n\r\n    fetch(`http://localhost:1337/reviews`, options)\r\n      .then(response => {\r\n        const contentType = response.headers.get(\"content-type\");\r\n        if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n          return response.json();\r\n        } else {\r\n          return \"udpated\";\r\n        }\r\n      })\r\n      .then(data => {\r\n        const errorField = document.getElementById(\"review-form-error\");\r\n        errorField.remove();\r\n      })\r\n      .catch(error => console.warn(error));\r\n  }\r\n\r\n  static sendDataOnline(obj) {\r\n    localStorage.setItem(\"ObjectToSend\", JSON.stringify(obj.data));\r\n    window.addEventListener(\"online\", event => {\r\n      let data = JSON.parse(localStorage.getItem(\"ObjectToSend\"));\r\n      if (data !== null) {\r\n        if (obj.name === \"postReview\") {\r\n          DBHelper.postReview(obj.data);\r\n        }\r\n        localStorage.removeItem(\"ObjectToSend\");\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * get Reviews by Id\r\n   * @param id\r\n   * @returns {Promise<Response>}\r\n   */\r\n  static getReviews(id) {\r\n    return fetch(`http://localhost:1337/reviews?restaurant_id=${id}`)\r\n      .then(function(response) {\r\n        return response.json();\r\n      })\r\n      .then(reviews => {\r\n        const dbPromise = idb.open(\"restaurantsDB\");\r\n        dbPromise.then(function(db) {\r\n          if (!db) return;\r\n\r\n          let tx = db.transaction(\"reviews\", \"readwrite\");\r\n          const store = tx.objectStore(\"reviews\");\r\n          if (Array.isArray(reviews)) {\r\n            reviews.forEach(function(review) {\r\n              store.put(review);\r\n            });\r\n          } else {\r\n            store.put(reviews);\r\n          }\r\n        });\r\n        return Promise.resolve(reviews);\r\n      })\r\n      .catch(error => {\r\n        console.warn(\"no connection\");\r\n        return DBHelper.getObject(\"reviews\", \"restaurant\", id).then(function(\r\n          sReviews\r\n        ) {\r\n          console.log(\"offline\");\r\n          return Promise.resolve(sReviews);\r\n        });\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Update is_favorite on the restaurant\r\n   * @param restaurantId\r\n   * @param isFavorite\r\n   */\r\n  static updateFavorite(restaurantId, isFavorite) {\r\n    const favorite = () => {\r\n      if (isFavorite) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    };\r\n\r\n    let restaurantObject = {\r\n      is_favorite: favorite()\r\n    };\r\n    const options = {\r\n      method: \"PUT\",\r\n      body: JSON.stringify(restaurantObject),\r\n      headers: new Headers({\r\n        \"Content-Type\": \"application/json\"\r\n      })\r\n    };\r\n\r\n    fetch(`${this.DATABASE_URL}/${restaurantId}`, options).then(() => {\r\n      const dbPromise = idb.open(\"restaurantsDB\");\r\n      dbPromise.then(db => {\r\n        const tx = db.transaction(\"restaurants\", \"readwrite\");\r\n        const store = tx.objectStore(\"restaurants\");\r\n        store.get(restaurantId).then(restaurant => {\r\n          restaurant.is_favorite = isFavorite;\r\n          store.put(restaurant);\r\n        });\r\n      });\r\n    });\r\n  }\r\n}\r\n","var getDefaultSettings = () => ({\n\telements_selector: \"img\",\n\tcontainer: window,\n\tthreshold: 300,\n\tthrottle: 150,\n\tdata_src: \"src\",\n\tdata_srcset: \"srcset\",\n\tdata_sizes: \"sizes\",\n\tdata_bg: \"bg\",\n\tclass_loading: \"loading\",\n\tclass_loaded: \"loaded\",\n\tclass_error: \"error\",\n\tclass_initial: \"initial\",\n\tskip_invisible: true,\n\tcallback_load: null,\n\tcallback_error: null,\n\tcallback_set: null,\n\tcallback_processed: null,\n\tcallback_enter: null,\n\tto_webp: false\n});\n\nconst getTopOffset = function(element) {\n\treturn (\n\t\telement.getBoundingClientRect().top +\n\t\twindow.pageYOffset -\n\t\telement.ownerDocument.documentElement.clientTop\n\t);\n};\n\nconst isBelowViewport = function(element, container, threshold) {\n\tconst fold =\n\t\tcontainer === window\n\t\t\t? window.innerHeight + window.pageYOffset\n\t\t\t: getTopOffset(container) + container.offsetHeight;\n\treturn fold <= getTopOffset(element) - threshold;\n};\n\nconst getLeftOffset = function(element) {\n\treturn (\n\t\telement.getBoundingClientRect().left +\n\t\twindow.pageXOffset -\n\t\telement.ownerDocument.documentElement.clientLeft\n\t);\n};\n\nconst isAtRightOfViewport = function(element, container, threshold) {\n\tconst documentWidth = window.innerWidth;\n\tconst fold =\n\t\tcontainer === window\n\t\t\t? documentWidth + window.pageXOffset\n\t\t\t: getLeftOffset(container) + documentWidth;\n\treturn fold <= getLeftOffset(element) - threshold;\n};\n\nconst isAboveViewport = function(element, container, threshold) {\n\tconst fold =\n\t\tcontainer === window ? window.pageYOffset : getTopOffset(container);\n\treturn fold >= getTopOffset(element) + threshold + element.offsetHeight;\n};\n\nconst isAtLeftOfViewport = function(element, container, threshold) {\n\tconst fold =\n\t\tcontainer === window ? window.pageXOffset : getLeftOffset(container);\n\treturn fold >= getLeftOffset(element) + threshold + element.offsetWidth;\n};\n\nfunction isInsideViewport(element, container, threshold) {\n\treturn (\n\t\t!isBelowViewport(element, container, threshold) &&\n\t\t!isAboveViewport(element, container, threshold) &&\n\t\t!isAtRightOfViewport(element, container, threshold) &&\n\t\t!isAtLeftOfViewport(element, container, threshold)\n\t);\n}\n\n/* Creates instance and notifies it through the window element */\nconst createInstance = function(classObj, options) {\n\tvar event;\n\tlet eventString = \"LazyLoad::Initialized\";\n\tlet instance = new classObj(options);\n\ttry {\n\t\t// Works in modern browsers\n\t\tevent = new CustomEvent(eventString, { detail: { instance } });\n\t} catch (err) {\n\t\t// Works in Internet Explorer (all versions)\n\t\tevent = document.createEvent(\"CustomEvent\");\n\t\tevent.initCustomEvent(eventString, false, false, { instance });\n\t}\n\twindow.dispatchEvent(event);\n};\n\n/* Auto initialization of one or more instances of lazyload, depending on the \n    options passed in (plain object or an array) */\nfunction autoInitialize(classObj, options) {\n\tif (!options) {\n\t\treturn;\n\t}\n\tif (!options.length) {\n\t\t// Plain object\n\t\tcreateInstance(classObj, options);\n\t} else {\n\t\t// Array of objects\n\t\tfor (let i = 0, optionsItem; (optionsItem = options[i]); i += 1) {\n\t\t\tcreateInstance(classObj, optionsItem);\n\t\t}\n\t}\n}\n\nconst replaceExtToWebp = (value, condition) =>\n\tcondition ? value.replace(/\\.(jpe?g|png)/gi, \".webp\") : value;\n\nconst detectWebp = () => {\n\tvar webpString = \"image/webp\";\n\tvar canvas = document.createElement(\"canvas\");\n\n\tif (canvas.getContext && canvas.getContext(\"2d\")) {\n\t\treturn canvas.toDataURL(webpString).indexOf(`data:${webpString}`) === 0;\n\t}\n\n\treturn false;\n};\n\nconst runningOnBrowser = typeof window !== \"undefined\";\n\nconst isBot =\n\t(runningOnBrowser && !(\"onscroll\" in window)) ||\n\t/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent);\nconst supportsClassList =\n\trunningOnBrowser && \"classList\" in document.createElement(\"p\");\n\nconst supportsWebp = runningOnBrowser && detectWebp();\n\nconst addClass = (element, className) => {\n\tif (supportsClassList) {\n\t\telement.classList.add(className);\n\t\treturn;\n\t}\n\telement.className += (element.className ? \" \" : \"\") + className;\n};\n\nconst removeClass = (element, className) => {\n\tif (supportsClassList) {\n\t\telement.classList.remove(className);\n\t\treturn;\n\t}\n\telement.className = element.className.\n\t\treplace(new RegExp(\"(^|\\\\s+)\" + className + \"(\\\\s+|$)\"), \" \").\n\t\treplace(/^\\s+/, \"\").\n\t\treplace(/\\s+$/, \"\");\n};\n\nconst dataPrefix = \"data-\";\nconst processedDataName = \"was-processed\";\nconst processedDataValue = \"true\";\n\nconst getData = (element, attribute) => {\n\treturn element.getAttribute(dataPrefix + attribute);\n};\n\nconst setData = (element, attribute, value) => {\n\tvar attrName = dataPrefix + attribute;\n\tif (value === null) {\n\t\telement.removeAttribute(attrName);\n\t\treturn;\n\t}\n\telement.setAttribute(attrName, value);\n};\n\nconst setWasProcessedData = element =>\n\tsetData(element, processedDataName, processedDataValue);\n\nconst getWasProcessedData = element =>\n\tgetData(element, processedDataName) === processedDataValue;\n\nconst setSourcesInChildren = function(\n\tparentTag,\n\tattrName,\n\tdataAttrName,\n\ttoWebpFlag\n) {\n\tfor (let i = 0, childTag; (childTag = parentTag.children[i]); i += 1) {\n\t\tif (childTag.tagName === \"SOURCE\") {\n\t\t\tlet attrValue = getData(childTag, dataAttrName);\n\t\t\tsetAttributeIfValue(childTag, attrName, attrValue, toWebpFlag);\n\t\t}\n\t}\n};\n\nconst setAttributeIfValue = function(\n\telement,\n\tattrName,\n\tvalue,\n\ttoWebpFlag\n) {\n\tif (!value) {\n\t\treturn;\n\t}\n\telement.setAttribute(attrName, replaceExtToWebp(value, toWebpFlag));\n};\n\nconst setSourcesImg = (element, settings) => {\n\tconst toWebpFlag = supportsWebp && settings.to_webp;\n\tconst srcsetDataName = settings.data_srcset;\n\tconst parent = element.parentNode;\n\n\tif (parent && parent.tagName === \"PICTURE\") {\n\t\tsetSourcesInChildren(parent, \"srcset\", srcsetDataName, toWebpFlag);\n\t}\n\tconst sizesDataValue = getData(element, settings.data_sizes);\n\tsetAttributeIfValue(element, \"sizes\", sizesDataValue);\n\tconst srcsetDataValue = getData(element, srcsetDataName);\n\tsetAttributeIfValue(element, \"srcset\", srcsetDataValue, toWebpFlag);\n\tconst srcDataValue = getData(element, settings.data_src);\n\tsetAttributeIfValue(element, \"src\", srcDataValue, toWebpFlag);\n};\n\nconst setSourcesIframe = (element, settings) => {\n\tconst srcDataValue = getData(element, settings.data_src);\n\n\tsetAttributeIfValue(element, \"src\", srcDataValue);\n};\n\nconst setSourcesVideo = (element, settings) => {\n\tconst srcDataName = settings.data_src;\n\tconst srcDataValue = getData(element, srcDataName);\n\n\tsetSourcesInChildren(element, \"src\", srcDataName);\n\tsetAttributeIfValue(element, \"src\", srcDataValue);\n\telement.load();\n};\n\nconst setSourcesBgImage = (element, settings) => {\n\tconst toWebpFlag = supportsWebp && settings.to_webp;\n\tconst srcDataValue = getData(element, settings.data_src);\n\tconst bgDataValue = getData(element, settings.data_bg);\n\n\tif (srcDataValue) {\n\t\tlet setValue = replaceExtToWebp(srcDataValue, toWebpFlag);\n\t\telement.style.backgroundImage = `url(\"${setValue}\")`;\n\t}\n\n\tif (bgDataValue) {\n\t\tlet setValue = replaceExtToWebp(bgDataValue, toWebpFlag);\n\t\telement.style.backgroundImage = setValue;\n\t}\n};\n\nconst setSourcesFunctions = {\n\tIMG: setSourcesImg,\n\tIFRAME: setSourcesIframe,\n\tVIDEO: setSourcesVideo\n};\n\nconst setSources = (element, settings) => {\n\tconst tagName = element.tagName;\n\tconst setSourcesFunction = setSourcesFunctions[tagName];\n\tif (setSourcesFunction) {\n\t\tsetSourcesFunction(element, settings);\n\t\treturn;\n\t}\n\tsetSourcesBgImage(element, settings);\n};\n\nconst callbackIfSet = function(callback, argument) {\n\tif (callback) {\n\t\tcallback(argument);\n\t}\n};\n\nconst genericLoadEventName = \"load\";\nconst mediaLoadEventName = \"loadeddata\";\nconst errorEventName = \"error\";\n\nconst addEventListener = (element, eventName, handler) => {\n\telement.addEventListener(eventName, handler);\n};\n\nconst removeEventListener = (element, eventName, handler) => {\n\telement.removeEventListener(eventName, handler);\n};\n\nconst addAllEventListeners = (element, loadHandler, errorHandler) => {\n\taddEventListener(element, genericLoadEventName, loadHandler);\n\taddEventListener(element, mediaLoadEventName, loadHandler);\n\taddEventListener(element, errorEventName, errorHandler);\n};\n\nconst removeAllEventListeners = (element, loadHandler, errorHandler) => {\n\tremoveEventListener(element, genericLoadEventName, loadHandler);\n\tremoveEventListener(element, mediaLoadEventName, loadHandler);\n\tremoveEventListener(element, errorEventName, errorHandler);\n};\n\nconst eventHandler = function(event, success, settings) {\n\tconst className = success ? settings.class_loaded : settings.class_error;\n\tconst callback = success ? settings.callback_load : settings.callback_error;\n\tconst element = event.target;\n\n\tremoveClass(element, settings.class_loading);\n\taddClass(element, className);\n\tcallbackIfSet(callback, element);\n};\n\nconst addOneShotEventListeners = (element, settings) => {\n\tconst loadHandler = event => {\n\t\teventHandler(event, true, settings);\n\t\tremoveAllEventListeners(element, loadHandler, errorHandler);\n\t};\n\tconst errorHandler = event => {\n\t\teventHandler(event, false, settings);\n\t\tremoveAllEventListeners(element, loadHandler, errorHandler);\n\t};\n\taddAllEventListeners(element, loadHandler, errorHandler);\n};\n\nconst managedTags = [\"IMG\", \"IFRAME\", \"VIDEO\"];\n\nfunction revealElement(element, settings, force) {\n\tif (!force && getWasProcessedData(element)) {\n\t\treturn; // element has already been processed and force wasn't true\n\t}\n\tcallbackIfSet(settings.callback_enter, element);\n\tif (managedTags.indexOf(element.tagName) > -1) {\n\t\taddOneShotEventListeners(element, settings);\n\t\taddClass(element, settings.class_loading);\n\t}\n\tsetSources(element, settings);\n\tsetWasProcessedData(element);\n\tcallbackIfSet(settings.callback_set, element);\n}\n\nconst removeFromArray = (elements, indexes) => {\n\twhile (indexes.length) {\n\t\telements.splice(indexes.pop(), 1);\n\t}\n};\n\n/*\n * Constructor\n */\n\nconst LazyLoad = function(instanceSettings) {\n\tthis._settings = Object.assign({}, getDefaultSettings(), instanceSettings);\n\tthis._queryOriginNode =\n\t\tthis._settings.container === window\n\t\t\t? document\n\t\t\t: this._settings.container;\n\n\tthis._previousLoopTime = 0;\n\tthis._loopTimeout = null;\n\tthis._boundHandleScroll = this.handleScroll.bind(this);\n\n\tthis._isFirstLoop = true;\n\twindow.addEventListener(\"resize\", this._boundHandleScroll);\n\tthis.update();\n};\n\nLazyLoad.prototype = {\n\t_loopThroughElements: function(forceDownload) {\n\t\tconst settings = this._settings,\n\t\t\telements = this._elements,\n\t\t\telementsLength = !elements ? 0 : elements.length;\n\t\tlet i,\n\t\t\tprocessedIndexes = [],\n\t\t\tisFirstLoop = this._isFirstLoop;\n\n\t\tif (isFirstLoop) {\n\t\t\tthis._isFirstLoop = false;\n\t\t}\n\n\t\tif (elementsLength === 0) {\n\t\t\tthis._stopScrollHandler();\n\t\t\treturn;\n\t\t}\n\n\t\tfor (i = 0; i < elementsLength; i++) {\n\t\t\tlet element = elements[i];\n\t\t\t/* If must skip_invisible and element is invisible, skip it */\n\t\t\tif (settings.skip_invisible && element.offsetParent === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tisBot ||\n\t\t\t\tforceDownload ||\n\t\t\t\tisInsideViewport(\n\t\t\t\t\telement,\n\t\t\t\t\tsettings.container,\n\t\t\t\t\tsettings.threshold\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif (isFirstLoop) {\n\t\t\t\t\taddClass(element, settings.class_initial);\n\t\t\t\t}\n\t\t\t\tthis.load(element);\n\t\t\t\tprocessedIndexes.push(i);\n\t\t\t}\n\t\t}\n\n\t\t// Removing processed elements from this._elements.\n\t\tremoveFromArray(elements, processedIndexes);\n\t},\n\n\t_purgeElements: function() {\n\t\tconst elements = this._elements,\n\t\t\telementsLength = elements.length;\n\t\tlet i,\n\t\t\tprocessedIndexes = [];\n\n\t\tfor (i = 0; i < elementsLength; i++) {\n\t\t\tif (getWasProcessedData(elements[i])) {\n\t\t\t\tprocessedIndexes.push(i);\n\t\t\t}\n\t\t}\n\t\tremoveFromArray(elements, processedIndexes);\n\t},\n\n\t_startScrollHandler: function() {\n\t\tif (!this._isHandlingScroll) {\n\t\t\tthis._isHandlingScroll = true;\n\t\t\tthis._settings.container.addEventListener(\n\t\t\t\t\"scroll\",\n\t\t\t\tthis._boundHandleScroll\n\t\t\t);\n\t\t}\n\t},\n\n\t_stopScrollHandler: function() {\n\t\tif (this._isHandlingScroll) {\n\t\t\tthis._isHandlingScroll = false;\n\t\t\tthis._settings.container.removeEventListener(\n\t\t\t\t\"scroll\",\n\t\t\t\tthis._boundHandleScroll\n\t\t\t);\n\t\t}\n\t},\n\n\thandleScroll: function() {\n\t\tconst throttle = this._settings.throttle;\n\n\t\tif (throttle !== 0) {\n\t\t\tlet now = Date.now();\n\t\t\tlet remainingTime = throttle - (now - this._previousLoopTime);\n\t\t\tif (remainingTime <= 0 || remainingTime > throttle) {\n\t\t\t\tif (this._loopTimeout) {\n\t\t\t\t\tclearTimeout(this._loopTimeout);\n\t\t\t\t\tthis._loopTimeout = null;\n\t\t\t\t}\n\t\t\t\tthis._previousLoopTime = now;\n\t\t\t\tthis._loopThroughElements();\n\t\t\t} else if (!this._loopTimeout) {\n\t\t\t\tthis._loopTimeout = setTimeout(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis._previousLoopTime = Date.now();\n\t\t\t\t\t\tthis._loopTimeout = null;\n\t\t\t\t\t\tthis._loopThroughElements();\n\t\t\t\t\t}.bind(this),\n\t\t\t\t\tremainingTime\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._loopThroughElements();\n\t\t}\n\t},\n\n\tloadAll: function() {\n\t\tthis._loopThroughElements(true);\n\t},\n\n\tupdate: function() {\n\t\t// Converts to array the nodeset obtained querying the DOM from _queryOriginNode with elements_selector\n\t\tthis._elements = Array.prototype.slice.call(\n\t\t\tthis._queryOriginNode.querySelectorAll(\n\t\t\t\tthis._settings.elements_selector\n\t\t\t)\n\t\t);\n\t\tthis._purgeElements();\n\t\tthis._loopThroughElements();\n\t\tthis._startScrollHandler();\n\t},\n\n\tdestroy: function() {\n\t\twindow.removeEventListener(\"resize\", this._boundHandleScroll);\n\t\tif (this._loopTimeout) {\n\t\t\tclearTimeout(this._loopTimeout);\n\t\t\tthis._loopTimeout = null;\n\t\t}\n\t\tthis._stopScrollHandler();\n\t\tthis._elements = null;\n\t\tthis._queryOriginNode = null;\n\t\tthis._settings = null;\n\t},\n\n\tload: function(element, force) {\n\t\trevealElement(element, this._settings, force);\n\t}\n};\n\n/* Automatic instances creation if required (useful for async script loading) */\nif (runningOnBrowser) {\n\tautoInitialize(LazyLoad, window.lazyLoadOptions);\n}\n\nexport default LazyLoad;\n","import DBHelper from \"./dbhelper\";\r\nimport LazyLoad from \"vanilla-lazyload\";\r\n\r\nlet restaurants, neighborhoods, cuisines;\r\nlet newMap;\r\nlet markers = [];\r\nlet self = {};\r\n\r\n/**\r\n * Fetch neighborhoods and cuisines as soon as the page is loaded.\r\n */\r\ndocument.addEventListener(\"DOMContentLoaded\", event => {\r\n  initMap(); // added\r\n  fetchNeighborhoods();\r\n  fetchCuisines();\r\n});\r\n\r\n/**\r\n * Fetch all neighborhoods and set their HTML.\r\n */\r\nconst fetchNeighborhoods = () => {\r\n  DBHelper.fetchNeighborhoods((error, neighborhoods) => {\r\n    if (error) {\r\n      // Got an error\r\n      console.error(error);\r\n    } else {\r\n      self.neighborhoods = neighborhoods;\r\n      fillNeighborhoodsHTML();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Set neighborhoods HTML.\r\n */\r\nconst fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {\r\n  const select = document.getElementById(\"neighborhoods-select\");\r\n  neighborhoods.forEach(neighborhood => {\r\n    const option = document.createElement(\"option\");\r\n    option.innerHTML = neighborhood;\r\n    option.value = neighborhood;\r\n    select.append(option);\r\n  });\r\n};\r\n\r\n/**\r\n * Fetch all cuisines and set their HTML.\r\n */\r\nconst fetchCuisines = () => {\r\n  DBHelper.fetchCuisines((error, cuisines) => {\r\n    if (error) {\r\n      // Got an error!\r\n      console.error(error);\r\n    } else {\r\n      self.cuisines = cuisines;\r\n      fillCuisinesHTML();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Set cuisines HTML.\r\n */\r\nconst fillCuisinesHTML = (cuisines = self.cuisines) => {\r\n  const select = document.getElementById(\"cuisines-select\");\r\n\r\n  cuisines.forEach(cuisine => {\r\n    const option = document.createElement(\"option\");\r\n    option.innerHTML = cuisine;\r\n    option.value = cuisine;\r\n    select.append(option);\r\n  });\r\n};\r\n\r\n/**\r\n * Initialize leaflet map, called from HTML.\r\n */\r\nconst initMap = () => {\r\n  self.newMap = new L.Map(\"map\", {\r\n    center: [40.722216, -73.987501],\r\n    zoom: 12,\r\n    scrollWheelZoom: false\r\n  });\r\n  L.tileLayer(\r\n    \"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}\",\r\n    {\r\n      mapboxToken:\r\n        \"pk.eyJ1IjoicnJqb3NvbiIsImEiOiJjamx4aHA4Y2owYXUyM3dtY2E3M2lxODFpIn0.kxpNETYtrRDiOihkJGy-eg\",\r\n      maxZoom: 18,\r\n      attribution:\r\n        'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\r\n        '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\r\n        'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n      id: \"mapbox.streets\"\r\n    }\r\n  ).addTo(self.newMap);\r\n\r\n  updateRestaurants();\r\n};\r\n\r\n/**\r\n * Update page and map for current restaurants.\r\n */\r\nconst updateRestaurants = () => {\r\n  const cSelect = document.getElementById(\"cuisines-select\");\r\n  const nSelect = document.getElementById(\"neighborhoods-select\");\r\n\r\n  const cIndex = cSelect.selectedIndex;\r\n  const nIndex = nSelect.selectedIndex;\r\n\r\n  const cuisine = cSelect[cIndex].value;\r\n  const neighborhood = nSelect[nIndex].value;\r\n\r\n  DBHelper.fetchRestaurantByCuisineAndNeighborhood(\r\n    cuisine,\r\n    neighborhood,\r\n    (error, restaurants) => {\r\n      if (error) {\r\n        // Got an error!\r\n        console.error(error);\r\n      } else {\r\n        resetRestaurants(restaurants);\r\n        fillRestaurantsHTML();\r\n      }\r\n    }\r\n  );\r\n};\r\n\r\n/**\r\n * Clear current restaurants, their HTML and remove their map markers.\r\n */\r\nconst resetRestaurants = restaurants => {\r\n  // Remove all restaurants\r\n  self.restaurants = [];\r\n  const ul = document.getElementById(\"restaurants-list\");\r\n  ul.innerHTML = \"\";\r\n\r\n  // Remove all map markers\r\n  if (self.markers) {\r\n    self.markers.forEach(marker => marker.remove());\r\n  }\r\n  self.markers = [];\r\n  self.restaurants = restaurants;\r\n};\r\n\r\n/**\r\n * Create all restaurants HTML and add them to the webpage.\r\n */\r\nconst fillRestaurantsHTML = (restaurants = self.restaurants) => {\r\n  const ul = document.getElementById(\"restaurants-list\");\r\n  restaurants.forEach(restaurant => {\r\n    ul.append(createRestaurantHTML(restaurant));\r\n  });\r\n  new LazyLoad();\r\n  addMarkersToMap();\r\n};\r\n\r\n/**\r\n * Create restaurant HTML.\r\n */\r\nconst createRestaurantHTML = restaurant => {\r\n  const li = document.createElement(\"li\");\r\n\r\n  const image = document.createElement(\"img\");\r\n  image.className = \"restaurant-img lazy\";\r\n  image.setAttribute(\"data-src\", DBHelper.imageUrlForRestaurant(restaurant));\r\n  image.alt = restaurant.name;\r\n  li.append(image);\r\n\r\n  const favorite = document.createElement(\"button\");\r\n  favorite.style.float = \"right\";\r\n\r\n  if (restaurant.is_favorite) {\r\n    favorite.innerHTML = \"★\";\r\n    favorite.setAttribute(\r\n      \"aria-label\",\r\n      \"Remove \" + restaurant.name + \" from list of favorites.\"\r\n    );\r\n  } else {\r\n    favorite.innerHTML = \"☆\";\r\n    favorite.setAttribute(\r\n      \"aria-label\",\r\n      \"Add \" + restaurant.name + \" to list of favorites.\"\r\n    );\r\n  }\r\n\r\n  favorite.onclick = () => {\r\n    if (restaurant.is_favorite) {\r\n      favorite.innerHTML = \"☆\";\r\n      favorite.setAttribute(\r\n        \"aria-label\",\r\n        \"Add \" + restaurant.name + \" to list of favorites.\"\r\n      );\r\n    } else {\r\n      favorite.innerHTML = \"★\";\r\n      favorite.setAttribute(\r\n        \"aria-label\",\r\n        \"Remove \" + restaurant.name + \" from list of favorites.\"\r\n      );\r\n    }\r\n\r\n    DBHelper.updateFavorite(restaurant.id, restaurant.is_favorite);\r\n    restaurant.is_favorite = !restaurant.is_favorite;\r\n  };\r\n\r\n  li.append(favorite);\r\n\r\n  const name = document.createElement(\"h3\");\r\n  name.innerHTML = restaurant.name;\r\n  li.append(name);\r\n\r\n  const neighborhood = document.createElement(\"p\");\r\n  neighborhood.innerHTML = restaurant.neighborhood;\r\n  li.append(neighborhood);\r\n\r\n  const address = document.createElement(\"p\");\r\n  address.innerHTML = restaurant.address;\r\n  li.append(address);\r\n\r\n  const more = document.createElement(\"a\");\r\n  more.innerHTML = \"View Details\";\r\n  more.setAttribute(\"aria-label\", \"View Details of \" + restaurant.name);\r\n  more.href = DBHelper.urlForRestaurant(restaurant);\r\n  li.append(more);\r\n\r\n  return li;\r\n};\r\n\r\n/**\r\n * Add markers for current restaurants to the map.\r\n */\r\nconst addMarkersToMap = (restaurants = self.restaurants) => {\r\n  restaurants.forEach(restaurant => {\r\n    // Add marker to the map\r\n    const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.newMap);\r\n    marker.on(\"click\", onClick);\r\n    function onClick() {\r\n      window.location.href = marker.options.url;\r\n    }\r\n    self.markers.push(marker);\r\n  });\r\n};\r\n"]}